(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9313:function(e,t,o){Promise.resolve().then(o.bind(o,7397)),Promise.resolve().then(o.t.bind(o,8877,23))},7397:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return l},a:function(){return s}});var a=o(7437),r=o(2265);let n=(0,r.createContext)(void 0);function s(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function l(e){let{children:t}=e,[o,s]=(0,r.useState)(null),[l,c]=(0,r.useState)(null),[i,u]=(0,r.useState)(!0),h=!!o;(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("access_token");if(e)try{let t=await fetch("http://localhost:8000/api/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();s(e)}else await d()||(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"))}catch(e){console.error("Failed to load user:",e),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}u(!1)})()},[]);let d=async()=>{let e=localStorage.getItem("refresh_token");if(!e)return!1;try{let t=await fetch("http://localhost:8000/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(t.ok){let e=await t.json();localStorage.setItem("access_token",e.access_token);let o=await fetch("http://localhost:8000/api/auth/me",{headers:{Authorization:"Bearer ".concat(e.access_token)}});if(o.ok){let e=await o.json();return s(e),!0}}return!1}catch(e){return console.error("Token refresh failed:",e),!1}},f=async e=>{try{let t;let o=localStorage.getItem("access_token"),a=await fetch("http://localhost:8000/api/user/analyses/summary",{headers:{Authorization:"Bearer ".concat(o)}}),r=0,n=!1;if(a.ok){let e=await a.json();r=e.total_analyses||0,t=e.last_analysis_date,n=r>0}let s=new Date().getTime()-new Date(e.created_at).getTime()<6048e5||0===r?"new":"returning",l="auto";"developer"===e.role&&(l="technical"),"investor"===e.role&&(l="business");let c="true"===localStorage.getItem("onboarding_completed_".concat(e.id));return{userType:s,hasAnalyses:n,analysisCount:r,onboardingCompleted:c,lastAnalysisDate:t,preferredView:l}}catch(e){return console.error("Failed to classify user:",e),{userType:"new",hasAnalyses:!1,analysisCount:0,onboardingCompleted:!1,preferredView:"auto"}}};return(0,r.useEffect)(()=>{o&&!l&&f(o).then(c)},[o,l]),(0,a.jsx)(n.Provider,{value:{user:o,userProfile:l,isAuthenticated:h,isLoading:i,login:(e,t)=>{let o="http://localhost:8000/api/auth/".concat(e),a=t?"".concat(o,"?analysis_id=").concat(t):o;window.location.href=a},logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),s(null),fetch("http://localhost:8000/api/auth/logout",{method:"POST"}).catch(console.error)},refreshToken:d,updateUserProfile:e=>{l&&(c({...l,...e}),e.onboardingCompleted&&o&&localStorage.setItem("onboarding_completed_".concat(o.id),"true"))},getViewMode:()=>l&&"auto"!==l.preferredView?"business"===l.preferredView?"business":"technical":(null==o?void 0:o.role)==="investor"?"business":(null==o?void 0:o.role)==="developer"?"technical":"business"},children:t})}},8877:function(){}},function(e){e.O(0,[404,971,23,744],function(){return e(e.s=9313)}),_N_E=e.O()}]);