(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9313:function(e,t,o){Promise.resolve().then(o.bind(o,7397)),Promise.resolve().then(o.t.bind(o,8877,23))},7397:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return l},a:function(){return c}});var a=o(7437),r=o(2265);let n=(0,r.createContext)(void 0);function c(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function l(e){let{children:t}=e,[o,c]=(0,r.useState)(null),[l,s]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("access_token");if(e)try{let t=await fetch("http://localhost:8000/api/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();c(e)}else await i()||(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"))}catch(e){console.error("Failed to load user:",e),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}s(!1)})()},[]);let i=async()=>{let e=localStorage.getItem("refresh_token");if(!e)return!1;try{let t=await fetch("http://localhost:8000/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(t.ok){let e=await t.json();localStorage.setItem("access_token",e.access_token);let o=await fetch("http://localhost:8000/api/auth/me",{headers:{Authorization:"Bearer ".concat(e.access_token)}});if(o.ok){let e=await o.json();return c(e),!0}}return!1}catch(e){return console.error("Token refresh failed:",e),!1}};return(0,a.jsx)(n.Provider,{value:{user:o,isAuthenticated:!!o,isLoading:l,login:(e,t)=>{let o="http://localhost:8000/api/auth/".concat(e),a=t?"".concat(o,"?analysis_id=").concat(t):o;window.location.href=a},logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),c(null),fetch("http://localhost:8000/api/auth/logout",{method:"POST"}).catch(console.error)},refreshToken:i},children:t})}},8877:function(){}},function(e){e.O(0,[404,971,23,744],function(){return e(e.s=9313)}),_N_E=e.O()}]);